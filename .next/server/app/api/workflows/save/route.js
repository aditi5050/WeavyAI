"use strict";(()=>{var e={};e.id=254,e.ids=[254],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},7561:e=>{e.exports=require("node:fs")},9411:e=>{e.exports=require("node:path")},3811:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>z,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{POST:()=>m});var a=r(9303),n=r(8716),i=r(670),s=r(6837),d=r(7070),l=r(3493),u=r(6091),p=r(6005);let c={randomUUID:p.randomUUID},w=new Uint8Array(256),g=w.length,f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));async function m(e){try{var t,r;let{userId:o}=await (0,s.I)();if(!o)return new d.NextResponse("Unauthorized",{status:401});let a=await e.json(),n=u.R.safeParse(a);if(!n.success)return new d.NextResponse("Invalid request body",{status:400});let{id:i,name:m,description:z,definition:y,nodes:h,edges:x}=n.data;await l.Z.user.upsert({where:{id:o},update:{},create:{id:o,email:"placeholder@weavy.ai"}});let b=i||(c.randomUUID?c.randomUUID():function(e,t,r){let o=(e=e||{}).random??e.rng?.()??(g>w.length-16&&((0,p.randomFillSync)(w),g=0),w.slice(g,g+=16));if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return function(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}(o)}(t,r,void 0)),v=await l.Z.$transaction(async e=>{let t=await e.workflow.upsert({where:{id:b},update:{name:m,description:z,definition:y,updatedAt:new Date},create:{id:b,userId:o,name:m,description:z,definition:y}});if(t.userId!==o)throw Error("Unauthorized access to workflow");for(let t of(await e.workflowEdge.deleteMany({where:{workflowId:b}}),await e.workflowNode.deleteMany({where:{workflowId:b}}),h))await e.workflowNode.create({data:{id:t.id,workflowId:b,type:t.type,label:t.label,positionX:t.position.x,positionY:t.position.y,config:t.data||{}}});for(let t of x)await e.workflowEdge.create({data:{id:t.id,workflowId:b,sourceId:t.source,targetId:t.target,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle}});return t});return d.NextResponse.json(v)}catch(e){return console.error("[WORKFLOW_SAVE]",e),new d.NextResponse("Internal Error",{status:500})}}let z=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/workflows/save/route",pathname:"/api/workflows/save",filename:"route",bundlePath:"app/api/workflows/save/route"},resolvedPagePath:"/workspaces/www.weavy.ai/app/api/workflows/save/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:x}=z,b="/api/workflows/save/route";function v(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},3493:(e,t,r)=>{r.d(t,{Z:()=>a});let o=require("@prisma/client"),a=globalThis.prisma??new o.PrismaClient},6091:(e,t,r)=>{r.d(t,{B:()=>n,R:()=>a});var o=r(7410);let a=o.z.object({id:o.z.string().optional(),name:o.z.string().min(1,"Name is required"),description:o.z.string().optional(),definition:o.z.record(o.z.any()),nodes:o.z.array(o.z.object({id:o.z.string(),type:o.z.string(),label:o.z.string(),position:o.z.object({x:o.z.number(),y:o.z.number()}),data:o.z.record(o.z.any()).optional()})),edges:o.z.array(o.z.object({id:o.z.string(),source:o.z.string(),target:o.z.string(),sourceHandle:o.z.string().nullable().optional(),targetHandle:o.z.string().nullable().optional()}))}),n=o.z.object({workflowId:o.z.string().uuid(),inputs:o.z.record(o.z.any()).optional()})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,837,410],()=>r(3811));module.exports=o})();